<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inicio</title>
    <link rel="stylesheet" href="../../index.css?v=20251011">
    <style>
        /* Forzar disposición vertical del formulario */
        #formulario {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-width: 480px;
            margin: 16px auto;
            padding: 12px;
            box-sizing: border-box;
            background: transparent;
        }
        #formulario label {
            display: block;
            font-weight: 600;
        }
        #formulario input[type="text"],
        #formulario input[type="number"],
        #formulario input[type="file"],
        #formulario select {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
        }
        #formulario button {
            align-self: flex-start;
            padding: 8px 16px;
        }
        figure { margin: 0; }
        #preview { max-width: 100%; height: auto; display: block; }
        @media (min-width: 700px) {
            #formulario { max-width: 600px; }
        }
    </style>
    <script src="../../index.js" defer></script>
    <script src="../../datos.js" defer></script>
</head>

<body>
   <form id="formulario" enctype="multipart/form-data">
    <label for="producto">Producto:</label>
    <select name="producto" id="producto" required>
        <option value="collar">Collar</option>
        <option value="manilla">Manilla</option>
        <option value="figura">Figura</option>
    </select>
    <label for="categoria">Categoría:</label>
    <select name="categoria" id="categoria">
        <option value="accesorios">Accesorios</option>
        <option value="figuras_personalizadas">Figuras Personalizadas</option>
        <option value="modelos_3d">Modelos 3D</option>
        <option value="pregrabado_madera">Pregrabado de madera</option>
        <option value="props">Props</option>
    </select>
    <label for="precio">Precio:</label>
    <input type="number" name="precio" id="precio">
    <label for="stock">Stock:</label>
    <select required name="stock" id="stock">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
    </select>
    <label for="imagen">Imagen:</label>
    <input type="file" name="imagen" id="imagen">
    <figure><img id="preview" src="" alt=""></figure>
    <button type="submit">Enviar</button>
   </form>
     <span id="respuesta"></span>
     <div id="productos" style="margin:20px auto; max-width:800px;"></div>
     <script src="../../assets/js/productos.js"></script>
     <script>
         // Vista previa de imagen
         const fileInput = document.getElementById('imagen');
         const previewImg = document.getElementById('preview');
         fileInput.addEventListener('change', () => {
                const f = fileInput.files && fileInput.files[0];
                if (f) { previewImg.src = URL.createObjectURL(f); }
         });

         document.addEventListener('DOMContentLoaded', () => {
                // Refrescar lista completa tras creación
                async function refrescarLista() {
                    try {
                        const productos = await ProductosAPI.listarProductos();
                        ProductosAPI.renderizarProductos(document.getElementById('productos'), productos, { mostrarStock: true });
                    } catch(e) {
                        document.getElementById('productos').innerHTML = '<p>Error: ' + e.message + '</p>';
                    }
                }
                refrescarLista();

                // Adaptar nombres de campos del formulario a la API
                const form = document.getElementById('formulario');
                form.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const fd = new FormData(form);
                    const nombre = fd.get('producto'); // usar selección como nombre
                    const precio = fd.get('precio');
                    const categoria = fd.get('categoria');
                    const stock = fd.get('stock');
                    const imagenFile = fd.get('imagen');
                    const btn = form.querySelector('button[type=submit]');
                    if (btn) btn.disabled = true;
                    try {
                        await ProductosAPI.crearProducto({ nombre, precio, categoria, stock, imagenFile });
                        form.reset();
                        previewImg.src = '';
                        refrescarLista();
                        document.getElementById('respuesta').textContent = 'Producto creado y listado actualizado.';
                    } catch(err) {
                        document.getElementById('respuesta').textContent = 'Error: ' + err.message;
                    } finally {
                        if (btn) btn.disabled = false;
                    }
                });
         });
     </script>
</body>



</html>